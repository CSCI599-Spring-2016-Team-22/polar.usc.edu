 
<!DOCTYPE html>
<html lang="en">
<head>
<title>CSCI 572 - Assignment 3 - Team 8 - Visualization 1</title> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans">
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/bootstrap-theme.min.css">
<link rel="stylesheet" href="css/facetview.css">
<link rel="stylesheet" href="css/jquery-ui-1.8.18.custom.css">
<link rel="stylesheet" href="css/transform.css"> 
<style>
 path {
  stroke: white;
  stroke-width: 0.25px;
  fill: #ff0000;
 }
 .bubble {
  fill-opacity: .5;
  stroke: #fff;
  stroke-width: .5px;
 }
</style>
</head>
<body>
<div class="container">
</ul>
</div>
  
<script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.facetview.js"></script>
<script type="text/javascript" src="js/d3.min.js"></script>
<script type="text/javascript" src="js/jquery.linkify-1.0-min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.18.custom.min.js"></script>
<script type="text/javascript" src="js/subraminion.js"></script>

  <div class="container">
    
  <!--div class="facet-view-simple"></div-->
  <div id="map"></div>
  <div id="location"></div>

  </div>
  
<script src="js/topojson.v0.min.js"></script>
<script>
var width = 900,
    height = 650;

var color_domain = [50, 150, 350, 750, 1500]
var ext_color_domain = [0, 50, 150, 350]
var legend_labels = ["Arctic", "Sub-arctic", "Sub-Antarctic", "Antarctic"]              
var color = d3.scale.threshold()
 .domain(color_domain)
 .range(["#694545", "firebrick", "#4ECAE3", "#3F3B63"]);

var jsonRectangles = [
   { "x_axis": 100, "y_axis": 250, "height": 150, "width":width-195, "color" : "#4ECAE3" },
   { "x_axis": 100, "y_axis": 350, "height": 280, "width":width-195, "color" : "#3F3B63" },
   { "x_axis": 100, "y_axis": 0, "height": 30, "width":width-195, "color" : "#694545" },
   { "x_axis": 100, "y_axis": 20, "height": 25, "width":width-195, "color" : "firebrick" }];

var max_x = 0;
var max_y = 0;
 
for (var i = 0; i < jsonRectangles.length; i++) {
  var temp_x, temp_y;
  var temp_x = jsonRectangles[i].x_axis + jsonRectangles[i].width;
  var temp_y = jsonRectangles[i].y_axis + jsonRectangles[i].height;

  if ( temp_x >= max_x ) { max_x = temp_x; }

  if ( temp_y >= max_y ) { max_y = temp_y; }
}

var radius = d3.scale.sqrt().domain([0,200]).range([0,15]);
var projection = d3.geo.mercator()
    .center([25,-35])
    .scale(120)
    .rotate([800,0]);

var svg = d3.select("#map").append("svg")
    .attr("width", "100%")
    .attr("height", "90%")
    .attr("viewBox", "0 0 " + width + "  "+ height)
    .attr("preserveAspectRatio", "xMidYMid");

var path = d3.geo.path()
    .projection(projection);

var g = svg.append("g").attr("class", "bubble");

// load and display the World
d3.json("json/world.json", function(error, topology) {

// load and display the cities
d3.json("http://ec2-54-149-243-158.us-west-2.compute.amazonaws.com:9000/solr/polardatatest/select?q=location%3A*&start=0&rows=0&wt=json&indent=true&facet=true&facet.field=location",function(error, data) {
  locationFreq = data.facet_counts.facet_fields.location;
  for(var i=0; i<locationFreq.length; i+=2) {
      var latlon = locationFreq[i].split(',');
      var lat = parseFloat(latlon[1]);
      if(lat <=50 && lat>=-40)continue;
      if(lat >= 90) latlon[1] = (lat-50).toString();
      if(lat <= -90) latlon[1] = (lat+50).toString();
      //console.log(latlon);
      g.append("circle")
       .attr("cx", projection(latlon)[0])
       .attr("cy", projection(latlon)[1])
       .attr("r", radius(locationFreq[i+1]))
       .style("fill", "red");
   }
});


g.selectAll("path")
      .data(topojson.object(topology, topology.objects.countries)
          .geometries)
    .enter()
      .append("path")
      .attr("d", path)
      .style("fill", "black");
//var locationFreq = getSolrData();

var rectangles = svg.selectAll("rect")
                             .data(jsonRectangles)
                             .enter()
                             .append("rect");

var rectangleAttributes = rectangles
                          .attr("x", function (d) { return d.x_axis; })
                          .attr("y", function (d) { return d.y_axis; })
                          .attr("height", function (d) { return d.height; })
                          .attr("width", function (d) { return d.width; })
                          .style("fill", function(d) { return d.color; })
			  .style("opacity", 0.3);


var legend = svg.selectAll("g.legend")
  .data(ext_color_domain)
  .enter().append("g")
  .attr("class", "legend");

  var ls_w = 20, ls_h = 20;

  legend.append("rect")
  .attr("x", -5)
  .attr("y", function(d, i){ return 0.35*height - (i*ls_h) - 2*ls_h;})
  .attr("width", ls_w)
  .attr("height", ls_h)
  .style("fill", function(d, i) { return color(d); })
  .style("opacity", 0.8);

  legend.append("text")
  .attr("x", 15)
  .attr("y", function(d, i){ return 0.35*height - (i*ls_h) - ls_h - 4;})
  .text(function(d, i){ return legend_labels[i]; });


});

// bubbles
function getSolrData() {
 var query = "http://ec2-54-149-243-158.us-west-2.compute.amazonaws.com:9000/solr/polardatatest/select?q=location%3A*&start=0&rows=0&wt=json&indent=true&facet=true&facet.field=location";
 $.ajax({
  url:query,
  method:'GET',
  success:function(response){ 
   //console.log(response);
  var x = JSON.parse(response);
  return x.facet_counts.facet_fields.location; 
  }
 });
}

</script>

</body>
</html>
